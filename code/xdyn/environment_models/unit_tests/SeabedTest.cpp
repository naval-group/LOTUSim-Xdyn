/*
 * SeabedTest.cpp
 *
 *  Created on: 3 June 2025
 *      Author: julien.prodhon
 */

#include "Seabed.hpp"
#include "SeabedTest.hpp"

#include <Eigen/Dense>
#include <vector>

#define STB_IMAGE_WRITE_IMPLEMENTATION
#include "ssc/stb/stb_image_write.h"

#include "gtest/gtest.h"


SeabedTest::SeabedTest () : a(ssc::random_data_generator::DataGenerator(54200))
{}

SeabedTest::~SeabedTest (){}

void SeabedTest::SetUp(){}

void SeabedTest::TearDown(){}

TEST_F(SeabedTest, seabed_write)
{
    const unsigned width = 16;
    const unsigned height = 16;
    const unsigned channels = 4; // RGBA = 4 channels

    std::vector<uint8_t> rgba_image = {
        75, 75, 75, 255, 72, 72, 72, 255, 73, 73, 73, 255, 69, 69, 69, 255, 66, 66, 66, 255,
        66, 66, 66, 255, 54, 54, 54, 255, 52, 52, 52, 255, 55, 55, 55, 255, 56, 56, 56, 255,
        57, 57, 57, 255, 60, 60, 60, 255, 61, 61, 61, 255, 61, 61, 61, 255, 60, 60, 60, 255,
        57, 57, 57, 255, 74, 74, 74, 255, 68, 68, 68, 255, 64, 64, 64, 255, 62, 62, 62, 255,
        62, 62, 62, 255, 61, 61, 61, 255, 57, 57, 57, 255, 58, 58, 58, 255, 58, 58, 58, 255,
        59, 59, 59, 255, 60, 60, 60, 255, 60, 60, 60, 255, 59, 59, 59, 255, 60, 60, 60, 255,
        58, 58, 58, 255, 57, 57, 57, 255, 77, 77, 77, 255, 69, 69, 69, 255, 63, 63, 63, 255,
        62, 62, 62, 255, 64, 64, 64, 255, 62, 62, 62, 255, 66, 66, 66, 255, 64, 64, 64, 255,
        61, 61, 61, 255, 62, 62, 62, 255, 62, 62, 62, 255, 59, 59, 59, 255, 55, 55, 55, 255,
        55, 55, 55, 255, 52, 52, 52, 255, 50, 50, 50, 255, 84, 84, 84, 255, 73, 73, 73, 255,
        65, 65, 65, 255, 64, 64, 64, 255, 69, 69, 69, 255, 68, 68, 68, 255, 70, 70, 70, 255,
        68, 68, 68, 255, 62, 62, 62, 255, 62, 62, 62, 255, 60, 60, 60, 255, 59, 59, 59, 255,
        53, 53, 53, 255, 49, 49, 49, 255, 44, 44, 44, 255, 44, 44, 44, 255, 84, 84, 84, 255,
        75, 75, 75, 255, 65, 65, 65, 255, 64, 64, 64, 255, 69, 69, 69, 255, 69, 69, 69, 255,
        69, 69, 69, 255, 70, 70, 70, 255, 61, 61, 61, 255, 62, 62, 62, 255, 56, 56, 56, 255,
        61, 61, 61, 255, 52, 52, 52, 255, 51, 51, 51, 255, 42, 42, 42, 255, 45, 45, 45, 255,
        83, 83, 83, 255, 76, 76, 76, 255, 70, 70, 70, 255, 68, 68, 68, 255, 69, 69, 69, 255,
        65, 65, 65, 255, 66, 66, 66, 255, 66, 66, 66, 255, 61, 61, 61, 255, 63, 63, 63, 255,
        58, 58, 58, 255, 61, 61, 61, 255, 51, 51, 51, 255, 50, 50, 50, 255, 42, 42, 42, 255,
        44, 44, 44, 255, 80, 80, 80, 255, 77, 77, 77, 255, 74, 74, 74, 255, 72, 72, 72, 255,
        70, 70, 70, 255, 68, 68, 68, 255, 66, 66, 66, 255, 67, 67, 67, 255, 62, 62, 62, 255,
        63, 63, 63, 255, 58, 58, 58, 255, 60, 60, 60, 255, 50, 50, 50, 255, 49, 49, 49, 255,
        41, 41, 41, 255, 43, 43, 43, 255, 80, 80, 80, 255, 75, 75, 75, 255, 74, 74, 74, 255,
        75, 75, 75, 255, 74, 74, 74, 255, 75, 75, 75, 255, 70, 70, 70, 255, 69, 69, 69, 255,
        63, 63, 63, 255, 64, 64, 64, 255, 58, 58, 58, 255, 58, 58, 58, 255, 49, 49, 49, 255,
        48, 48, 48, 255, 39, 39, 39, 255, 41, 41, 41, 255, 78, 78, 78, 255, 75, 75, 75, 255,
        76, 76, 76, 255, 77, 77, 77, 255, 76, 76, 76, 255, 78, 78, 78, 255, 73, 73, 73, 255,
        70, 70, 70, 255, 64, 64, 64, 255, 64, 64, 64, 255, 58, 58, 58, 255, 58, 58, 58, 255,
        49, 49, 49, 255, 48, 48, 48, 255, 40, 40, 40, 255, 42, 42, 42, 255, 79, 79, 79, 255,
        76, 76, 76, 255, 80, 80, 80, 255, 79, 79, 79, 255, 76, 76, 76, 255, 78, 78, 78, 255,
        72, 72, 72, 255, 69, 69, 69, 255, 61, 61, 61, 255, 61, 61, 61, 255, 56, 56, 56, 255,
        59, 59, 59, 255, 50, 50, 50, 255, 50, 50, 50, 255, 41, 41, 41, 255, 44, 44, 44, 255,
        80, 80, 80, 255, 77, 77, 77, 255, 79, 79, 79, 255, 79, 79, 79, 255, 76, 76, 76, 255,
        78, 78, 78, 255, 70, 70, 70, 255, 69, 69, 69, 255, 62, 62, 62, 255, 61, 61, 61, 255,
        56, 56, 56, 255, 58, 58, 58, 255, 51, 51, 51, 255, 49, 49, 49, 255, 43, 43, 43, 255,
        44, 44, 44, 255, 79, 79, 79, 255, 75, 75, 75, 255, 77, 77, 77, 255, 77, 77, 77, 255,
        76, 76, 76, 255, 79, 79, 79, 255, 68, 68, 68, 255, 70, 70, 70, 255, 63, 63, 63, 255,
        60, 60, 60, 255, 56, 56, 56, 255, 56, 56, 56, 255, 51, 51, 51, 255, 51, 51, 51, 255,
        48, 48, 48, 255, 45, 45, 45, 255, 77, 77, 77, 255, 76, 76, 76, 255, 78, 78, 78, 255,
        78, 78, 78, 255, 76, 76, 76, 255, 79, 79, 79, 255, 67, 67, 67, 255, 69, 69, 69, 255,
        61, 61, 61, 255, 59, 59, 59, 255, 57, 57, 57, 255, 56, 56, 56, 255, 51, 51, 51, 255,
        54, 54, 54, 255, 50, 50, 50, 255, 48, 48, 48, 255, 77, 77, 77, 255, 77, 77, 77, 255,
        81, 81, 81, 255, 81, 81, 81, 255, 78, 78, 78, 255, 80, 80, 80, 255, 69, 69, 69, 255,
        70, 70, 70, 255, 60, 60, 60, 255, 62, 62, 62, 255, 59, 59, 59, 255, 60, 60, 60, 255,
        55, 55, 55, 255, 55, 55, 55, 255, 50, 50, 50, 255, 47, 47, 47, 255, 80, 80, 80, 255,
        80, 80, 80, 255, 83, 83, 83, 255, 83, 83, 83, 255, 81, 81, 81, 255, 80, 80, 80, 255,
        74, 74, 74, 255, 73, 73, 73, 255, 63, 63, 63, 255, 64, 64, 64, 255, 63, 63, 63, 255,
        64, 64, 64, 255, 59, 59, 59, 255, 55, 55, 55, 255, 52, 52, 52, 255, 48, 48, 48, 255,
        83, 83, 83, 255, 81, 81, 81, 255, 83, 83, 83, 255, 83, 83, 83, 255, 80, 80, 80, 255,
        81, 81, 81, 255, 76, 76, 76, 255, 77, 77, 77, 255, 65, 65, 65, 255, 66, 66, 66, 255,
        65, 65, 65, 255, 67, 67, 67, 255, 61, 61, 61, 255, 57, 57, 57, 255, 54, 54, 54, 255,
        50, 50, 50, 255,
    };
    stbi_write_png("seabedtest.png", width, height, channels, rgba_image.data(),width * channels);
    ASSERT_DOUBLE_EQ(0.0, 0);
}

TEST_F(SeabedTest, parse_seabed_from_double)
{
    double depth = 65.65;
    Seabed seabed(depth);
    double depth_out = seabed.get_height(1,2);
    ASSERT_DOUBLE_EQ(depth_out, depth);
    Eigen::Vector2d grad_out = seabed.get_gradient(1,2);
    ASSERT_DOUBLE_EQ(grad_out(0), 0);
    ASSERT_DOUBLE_EQ(grad_out(1), 0);
}

TEST_F(SeabedTest, parse_seabed_from_file)
{
    Seabed seabed("seabedtest.png");
    seabed.get_height(135,-3);
    seabed.get_gradient(-120,4.4);
}
